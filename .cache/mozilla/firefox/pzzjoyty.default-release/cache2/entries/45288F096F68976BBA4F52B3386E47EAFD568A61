define([ 'app', 'app/app-models', 'i18n!app/disk/nls/disk-i18n' ], function(app, appModels, i18n) {
	app.module('disk', function(disk, app, Backbone, Marionette, $, _) {

		function isPopup() {
			try {
				if (window.opener && window.opener.location.pathname != window.location.pathname)
					return true;
				if (/.*\/popup\/.*/.test(window.location.pathname))
					return true;
				else
					return false;
			} catch (error) {
				if (/.*\/popup\/.*/.test(window.location.pathname))
					return true;
				else
					return false;
			}
		}

		disk.UserModel = app.BackboneModel.extend({
			urlRoot : function() {
				if (isPopup())
					return '../disk/users';
				else
					return 'disk/users';
			},

			idAttribute : 'USERS_IDX',

			defaults : {
				USERS_IDX : 'user',
				USERS_PASSWD : '',
				HOME_DIRECTORY : '',
				ENABLE_FLAG : 0,
				READ_PERMISSION : 0,
				WRITE_PERMISSION : 0,
				REMOVE_PERMISSION : 0,
				IDLE_TIME : 0,
				UPLOAD_RATE : 0,
				DOWNLOAD_RATE : 0,
				MAX_LOGIN_NUMBER : 0,
				MAX_LOGIN_PER_IP : 0,
				DISK_USAGE : 0,
				DISK_QUOTA : 0,
				BIGMAIL_VALIDITY_DAYS : 0,
				BIGMAIL_DOWNLOAD_LIMIT : 0,
				USERS_NAME : '',
				LAST_ACCESS_TIME : '',
				LAST_ACCESS_IP : '',
				BIGMAIL_MAX_VALIDITY_DAYS : 0,
				BIGMAIL_MAX_DOWNLOAD_LIMIT : 0,
				EMPTY_TRASH_DAYS : 0,
				BIGMAIL_PASSWORD_REQUIRED : 0
			},

			constructor : function() {
				app.BackboneModel.apply(this, arguments);
			},

			initialize : function(attributes, options) {
				app.BackboneModel.prototype.initialize.apply(this, arguments);
			},

			parse : function(response, options) {
				return response;
			},

			validate : function(attrs, options) {
				var errors = {};
				if (!_.isEmpty(errors))
					return errors;
			},

		}); // disk.UserModel = app.BackboneModel.extend({...});

		disk.QuotaModel = app.BackboneModel.extend({
			url : function() {
				if (isPopup())
					return '../../disk/' + this.id + '/quota';
				else
					return 'disk/' + this.id + '/quota';
			},

			idAttribute : 'id',

			defaults : {
				usage : 0,
				quota : 0
			},

			constructor : function() {
				app.BackboneModel.apply(this, arguments);
			},

			initialize : function(attributes, options) {
				app.BackboneModel.prototype.initialize.apply(this, arguments);
			},

			parse : function(response, options) {
				return response;
			},

			validate : function(attrs, options) {
				var errors = {};
				if (!_.isEmpty(errors))
					return errors;
			},

		}); // disk.QuotaModel = app.BackboneModel.extend({...});

		disk.ConfigModel = app.BackboneModel.extend({
			url : function() {
				if (isPopup())
					return '../../disk/config';
				else
					return 'disk/config';
			},

			idAttribute : 'DOMAIN',

			defaults : {
				DOMAIN : '',
				DISK_USER_MAX_QUOTA : 0,
				BIGMAIL_MAX_VALIDITY_DAYS : 0,
				BIGMAIL_MAX_DOWNLOAD_LIMIT : 0,
				WEBLINK_FOLDER_ENABLE : 0,
				GUEST_FOLDER_ENABLE : 0,
				VIRUS_CHECK_ENABLE : 0,
				UPLOAD_FILE_SIZE_LIMIT : 0,
				LOG_USER_VIEW_MONTHS : 0,
				LOG_PRESERVATION_MONTHS : 0
			},

			constructor : function() {
				app.BackboneModel.apply(this, arguments);
			},

			initialize : function(attributes, options) {
				app.BackboneModel.prototype.initialize.apply(this, arguments);
			},

			parse : function(response, options) {
				return response;
			},

			validate : function(attrs, options) {
				var errors = {};
				if (!_.isEmpty(errors))
					return errors;
			},

		}); // disk.ConfigModel = app.BackboneModel.extend({...});

		disk.FileModel = app.BackboneModel.extend({
			urlRoot : function() {
				if (isPopup())
					return '../../disk';
				else
					return 'disk';
			},

			idAttribute : 'id',

			defaults : {
				id : '',
				file : false,
				directory : false,
				readable : false,
				writable : false,
				removable : false,
				starred : false,
				linkCount : '',
				user : '',
				group : '',
				size : 0,
				lastModified : 0,
				name : '',
				path : '',
			},

			constructor : function() {
				app.BackboneModel.apply(this, arguments);
			},

			initialize : function(attributes, options) {
				app.BackboneModel.prototype.initialize.apply(this, arguments);
				if (attributes && !this.folders && !this.files) {
					this.folders = new disk.FileCollection();
					this.files = new disk.FileCollection();
					if (this.idAttribute in attributes) {
						this.folders.pathname = attributes[this.idAttribute];
						this.files.pathname = attributes[this.idAttribute];
					}
				}
			},

			parse : function(response, options) {
				var attributes = response.attributes;
				if (attributes && attributes.folders) { // not in use
					if (this.folders) {
						this.folders.reset(attributes.folders);
					} else {
						this.folders = new disk.FileCollection(attributes.folders);
						if (this.idAttribute in attributes)
							this.folders.pathname = attributes[this.idAttribute];
					}
					delete attributes.folders;
				}
				return response;
			},

			validate : function(attrs, options) {
				var errors = {};
				if (!_.isEmpty(errors))
					return errors;
			},

			destroy : function(options) {
				options = options ? options : {};
				var pathname = this.pathname ? this.pathname : this.get('path') + '/' + this.get('name');
				var url = this.url;
				if (Backbone.emulateJSON) {
					options.data = {
						_method : 'DELETE',
						pathname : pathname,
					};
				} else {
					this.url = function() {
						var base = _.result(this, 'urlRoot') || _.result(this.collection, 'url');
						return base.replace(/([^\/])$/, '$1/') + this.id + '?pathname=' + encodeURIComponent(pathname);
					};
				}
				var jqXHR = app.BackboneModel.prototype.destroy.call(this, options);
				this.url = url;
				return jqXHR;
			},

		}); // disk.FileModel = app.BackboneModel.extend({...});

		disk.FileCollection = app.BackboneCollection.extend({
			url : function() {
				if (isPopup())
					return '../../disk/' + this.pathname.replace(/^([^\/])/, '$1') + '/files';
				else
					return 'disk/' + this.pathname.replace(/^([^\/])/, '$1') + '/files';
			},

			model : disk.FileModel,

			constructor : function() {
				app.BackboneCollection.apply(this, arguments);
			},

			initialize : function(models, options) {
				app.BackboneCollection.prototype.initialize.apply(this, arguments);
			},

			parse : function(response, options) {
				return response;
			},
		}); // disk.FileCollection = app.BackboneCollection.extend({...});

		disk.FilePaginator = app.ClientPaginator.extend({

			model : disk.FileModel,

			paginator_core : {
				type : 'GET',
				dataType : 'json',
				url : function() { // Inactive code
					if (isPopup())
						return '../../disk/files';
					else
						return 'disk/files';
				}
			},

			paginator_ui : {
				firstPage : 1,
				currentPage : 1,
				perPage : 10,
				totalPages : 1,
				pagesInRange : 10,
				sortColumn : 'lastModified',
				sortDirection : 'desc'
			},

			constructor : function() {
				app.ClientPaginator.apply(this, arguments);
			},

			initialize : function(models, options) {
				app.ClientPaginator.prototype.initialize.apply(this, arguments);
			},

			parse : function(response, options) {
				app.ClientPaginator.prototype.parse.apply(this, arguments);
				return response;
			},

			_sort : function(models, sort, direction) {
				var compare = function(a, b) {
					var ac = a.get(sort), bc = b.get(sort);
					if (sort === 'type') {
						ac = a.get('name'), bc = b.get('name');
						if (ac.lastIndexOf('.') > -1)
							ac = ac.substring(ac.lastIndexOf('.') + 1);
						if (bc.lastIndexOf('.') > -1)
							bc = bc.substring(bc.lastIndexOf('.') + 1);
					}
					if (sort === 'path') {
						if (ac.match(/^\/ë§ˆì´ë””ìŠ¤í¬/))
							ac = ac.replace(/^\/ë§ˆì´ë””ìŠ¤í¬/, '/1');
						if (ac.match(/^\/ë§ˆì´ë””ìŠ¤í¬\/ëŒ€ìš©ëŸ‰ë©”ì¼/))
							ac = ac.replace(/^\/ë§ˆì´ë””ìŠ¤í¬\/ëŒ€ìš©ëŸ‰ë©”ì¼/, '/1/' + i18n.folder.largeAttachments);
						if (ac.match(/^\/ê³µìœ ë””ìŠ¤í¬/))
							ac = ac.replace(/^\/ê³µìœ ë””ìŠ¤í¬/, '/2');
						if (bc.match(/^\/ë§ˆì´ë””ìŠ¤í¬/))
							bc = bc.replace(/^\/ë§ˆì´ë””ìŠ¤í¬/, '/1');
						if (bc.match(/^\/ë§ˆì´ë””ìŠ¤í¬\/ëŒ€ìš©ëŸ‰ë©”ì¼/))
							bc = bc.replace(/^\/ë§ˆì´ë””ìŠ¤í¬\/ëŒ€ìš©ëŸ‰ë©”ì¼/, '/1/' + i18n.folder.largeAttachments);
						if (bc.match(/^\/ê³µìœ ë””ìŠ¤í¬/))
							bc = bc.replace(/^\/ê³µìœ ë””ìŠ¤í¬/, '/2');
					}
					if (disk.folderModel.get('linkCount') === 'BigMail') {
						switch (sort) {
						case 'uploaded':
							ac = a.get('linkCount'), bc = b.get('linkCount');
							ac = ac.substring(ac.lastIndexOf('.') + 1);
							bc = bc.substring(bc.lastIndexOf('.') + 1);
							break;
						case 'downloads':
							ac = a.get('user'), bc = b.get('user');
						}
					}
					if (disk.folderModel.get('linkCount') === 'Trash') {
						switch (sort) {
						case 'name':
							ac = a.get('name'), bc = b.get('name');
							ac = ac.substring(ac.lastIndexOf('/') + 1);
							bc = bc.substring(bc.lastIndexOf('/') + 1);
							break;
						case 'path':
							ac = a.get('name'), bc = b.get('name');
							if (ac.lastIndexOf('/') > 0)
								ac = ac.substring(0, ac.lastIndexOf('/'));
							else
								ac = '/';
							if (bc.lastIndexOf('/') > 0)
								bc = bc.substring(0, bc.lastIndexOf('/'));
							else
								bc = '/';
						}
					}
					switch (disk.folderModel.get('linkCount')) {
					case 'SearchResults':
					case 'Starred':
					case 'Recent':
						if (sort === 'lastModified') {
							ac = a.get('linkCount'), bc = b.get('linkCount');
							if (/^[0-9]+\.[0-9]+\.[0-9]+$/.test(ac))
								ac = ac.substring(ac.lastIndexOf('.') + 1);
							else
								ac = a.get(sort);
							if (/^[0-9]+\.[0-9]+\.[0-9]+$/.test(bc))
								bc = bc.substring(bc.lastIndexOf('.') + 1);
							else
								bc = b.get(sort);
						}
					}
					if (_.isUndefined(ac) || _.isUndefined(bc) || ac === null || bc === null) {
						return 0;
					} else {
						// Make sure that both ac and bc are lowercase strings.
						// .toString() first so we don't have to worry
						// if ac or bc have other String-only methods.
						ac = ac.toString().toLowerCase();
						bc = bc.toString().toLowerCase();
					}
					if (direction === 'desc') {
						// We need to know if there aren't any non-number characters
						// and that there are numbers-only characters and maybe a dot
						// if we have a float.
						// Oh, also a '-' for negative numbers!
						if ((!ac.match(/[^\-\d\.]/) && ac.match(/-?[\d\.]+/))
								&& (!bc.match(/[^\-\d\.]/) && bc.match(/-?[\d\.]+/))) {
							if ((ac - 0) < (bc - 0))
								return 1;
							if ((ac - 0) > (bc - 0))
								return -1;
						} else {
							if (ac < bc)
								return 1;
							if (ac > bc)
								return -1;
						}
					} else {
						// Same as the regexp check in the 'if' part.
						if ((!ac.match(/[^\-\d\.]/) && ac.match(/-?[\d\.]+/))
								&& (!bc.match(/[^\-\d\.]/) && bc.match(/-?[\d\.]+/))) {
							if ((ac - 0) < (bc - 0))
								return -1;
							if ((ac - 0) > (bc - 0))
								return 1;
						} else {
							if (ac < bc)
								return -1;
							if (ac > bc)
								return 1;
						}
					}
					if (a.cid && b.cid) {
						var aId = a.cid, bId = b.cid;
						if (aId < bId)
							return -1;
						if (aId > bId)
							return 1;
					}
					return 0;
				};
				var folderModels = _.filter(models, function(model) {
					return model.get('directory') === true;
				});
				var fileModels = _.filter(models, function(model) {
					return model.get('file') === true;
				});
				folderModels.sort(compare);
				fileModels.sort(compare);
				if (sort === 'lastModified') {
					models = folderModels.concat(fileModels);
				} else if (sort === 'name' && direction !== 'asc') {
					models = fileModels.concat(folderModels);
				} else if (sort === 'size') {
					models = fileModels.concat(folderModels);
				} else {
					models = folderModels.concat(fileModels);
				}
				return models;
			},

			goTo : function(page, options) {
				if (page !== undefined) {
					this.currentPage = parseInt(page, 10);
					return this.pager(options);
				} else {
					var reject = function() {
						var response = new $.Deferred();
						response.reject();
						return response.promise();
					};
					return reject();
				}
			},

			resetDefaults : function(params) {
				params = params ? params : {};
				if (params.id) {
					this.folderId = params.id;
				} else {
					delete this.folderId;
				}
				if (params.firstPage) {
					this.firstPage = params.firstPage;
				} else {
					this.firstPage = this.paginator_ui.firstPage;
				}
				if (params.currentPage && !isNaN(params.currentPage)) {
					this.currentPage = parseInt(params.currentPage);
				} else {
					this.currentPage = this.paginator_ui.currentPage;
				}
				if (params.perPage && !isNaN(params.perPage)) {
					this.perPage = parseInt(params.perPage);
				} else {
					if (app.userModel && app.userModel.get('USERS_LISTNUM'))
						this.perPage = app.userModel.get('USERS_LISTNUM');
					else
						this.perPage = this.paginator_ui.perPage;
				}
				if (!params.sortColumn && !this.sortColumn) {
					this.sortColumn = this.paginator_ui.sortColumn;
				} else if (params.sortColumn && this.sortColumn !== params.sortColumn) {
					this.lastSortColumn = this.sortColumn;
					this.sortColumn = params.sortColumn;
				}
				if (!params.sortDirection && !this.sortDirection) {
					this.sortDirection = this.paginator_ui.sortDirection;
				} else if (params.sortDirection && this.sortDirection !== params.sortDirection) {
					this.sortDirection = params.sortDirection;
				}
				if (params.search) {
					this.search = params.search;
				} else {
					delete this.search;
				}
			},

			getURL : function(params) {
				if (!params)
					params = {};
				var url = 'disk/files';
				if (/^#attachments(\/)?.*/.test(location.hash)) {
					url = 'attachments/files';
				}
				if (params.currentPage && !isNaN(params.currentPage)) {
					url += '?currentPage=' + params.currentPage;
				} else {
					url += '?currentPage=' + this.currentPage;
				}
				if (params.perPage && !isNaN(params.perPage)) {
					url += '&perPage=' + params.perPage;
				} else {
					url += '&perPage=' + this.perPage;
				}
				if (params.sortColumn) {
					url += '&sortColumn=' + params.sortColumn;
				} else {
					url += '&sortColumn=' + this.sortColumn;
				}
				if (params.sortDirection) {
					url += '&sortDirection=' + params.sortDirection;
				} else {
					url += '&sortDirection=' + this.sortDirection;
				}
				if (params.id) {
					url += '&id=' + params.id;
				} else if (this.folderId) {
					url += '&id=' + this.folderId;
				}
				var search = params.search || this.search;
				if (typeof search == 'string') {
					url += '&search=' + encodeURIComponent(search);
				} else if (typeof search == 'object') {
					for ( var p in search)
						url += '&search.' + p + '=' + encodeURIComponent(search[p]);
				}
				url += '&_=' + (Date.now ? Date.now() : (new Date()).getTime());
				return url;
			},

		}); // disk.FilePaginator

		disk.FileFilterModel = app.BackboneModel.extend({
			urlRoot : 'disk/file-filters',

			idAttribute : 'FILTER_ID',

			defaults : {
				// FILTER_ID : 0,
				FILTER_ITEM : '',
			},

			constructor : function() {
				app.BackboneModel.apply(this, arguments);
			},

			initialize : function(attributes, options) {
				app.BackboneModel.prototype.initialize.apply(this, arguments);
			},

			parse : function(response, options) {
				return response;
			},

			validate : function(attrs, options) {
				var errors = {};
				if (!_.isEmpty(errors))
					return errors;
			},

		}); // disk.FileFilterModel = app.BackboneModel.extend({...});

		disk.FileFilterCollection = app.BackboneCollection.extend({
			url : function() {
				if (isPopup())
					return '../disk/file-filters';
				else
					return 'disk/file-filters';
			},

			model : disk.FileFilterModel,

			constructor : function() {
				app.BackboneCollection.apply(this, arguments);
			},

			initialize : function(models, options) {
				app.BackboneCollection.prototype.initialize.apply(this, arguments);
			},

			parse : function(response, options) {
				return response;
			},
		}); // disk.FileFilterCollection = app.BackboneCollection.extend({...});

	}); // app.module('disk', function(){...});
}); // define(['app'], function(app){...});
¥¤³-nõ      cÚ[cÚ[E6MccãUÚ   t    O^partitionKey=%28http%2Cseoultech.ac.kr%29,:http://mail.seoultech.ac.kr/mail/app/disk/disk-models.js?v=202301181454 necko:classified 1 strongly-framed 1 request-method GET response-head HTTP/1.1 200 
Accept-Ranges: bytes
ETag: W/"16938-1664418066000"
Last-Modified: Thu, 29 Sep 2022 02:21:06 GMT
Content-Type: application/javascript;charset=UTF-8
Content-Length: 16938
Date: Wed, 01 Feb 2023 07:57:14 GMT
 original-response-headers Accept-Ranges: bytes
ETag: W/"16938-1664418066000"
Last-Modified: Thu, 29 Sep 2022 02:21:06 GMT
Content-Type: application/javascript;charset=UTF-8
Content-Length: 16938
Date: Wed, 01 Feb 2023 07:57:14 GMT
 ctid 2 uncompressed-len 0 net-response-time-onstart 81 net-response-time-onstop 81   B*